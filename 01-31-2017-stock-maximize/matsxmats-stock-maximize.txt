Run with the input as infile

I redefined the input format somewhat, and only expect lines of stock histories

perl -MList::Util=max -pae '$_=0;for$i(0..@F-1){max(@F[$i+1,@F-1])>$F[$i]?do{$s++;$_-=$F[$i]}:do{$_+=$s*$F[$i];$s=0}};$_.="\n"' infile


